- if current_user
  .row
    .span12
      %h1= t('welcome_back', name: current_user.name)
      %hr

      - if current_user.students.length > 0 || current_user.teacher?
        %h4 #{t('home.classroom')}:

        %p
          = link_to t('home.teacher_student_count', count: current_user.students.length), manage_followers_path
          = t('home.teacher_averages', trophy_average: ("%.1f" % current_user.average_student_trophies), trophy_max: Trophy::TROPHY_MAX)

        = render partial: 'shared/teacher_nav', locals: { current: 'home' }
        %hr

      %h4 #{t('home.student_progress')}:
      = t('home.student_stats', trophy_count: current_user.trophy_count, trophy_max: Trophy::TROPHY_MAX)
      %br/

      %div{ style: 'padding-top: 10px; padding-bottom: 10px;'}
        = render partial: 'shared/student_continue', locals: { include_finished: true }
        - if !current_user.teacher? && current_user.teachers.length == 0
          = link_to t('add_teacher_form.submit'), "#" + :teacher_email_or_code.to_s
- else
  %h3= link_to t('try_hoc'), hoc_reset_path()
  = link_to t('already_started'), hoc_chapter_path(ScriptLevel::NEXT)
  %br/
  %br/

  %hr

  %h3= link_to t('try_k8intro'), k8intro_chapter_path(ScriptLevel::NEXT)
  = image_tag 'signup_header.jpg'
  %br/

  - unless Rails.configuration.minimal_mode
    %br/
    %p
      #{t('nav.user.signup')}: #{link_to t('home.student_reg_link'), new_user_registration_path} | #{link_to t('home.teacher_reg_link'), new_user_registration_path('user[user_type]' => User::TYPE_TEACHER)}.
      #{raw t('home.signin_message', link: link_to(t('nav.user.signin'), new_user_session_path))}.


.row
  .span12
    = render partial: 'shared/user_stats', locals: { user: current_user, trophies_on_right: true }

%br/
- if current_user && !current_user.teacher?
  - if current_user.teachers.length >= 1
    = t('teacher.title', count: current_user.teachers.length)
    = raw current_user.teachers.map{|t| t[:name] + ' ' + link_to(t('teacher.remove'), remove_follower_path(teacher_user_id: t[:id], student_user_id: current_user.id), method: :post)}.join(', ')
  - else
    %h4= t('add_teacher_form.code_or_email.label')
    = form_for([Follower.new]) do |f|
      .field
        = text_field_tag :teacher_email_or_code, nil, class: 'input-xxlarge', placeholder: t('add_teacher_form.code_or_email.placeholder'), :required => true
        = hidden_field_tag :redirect, root_path
      .actions
        = f.submit t('add_teacher_form.submit')
%br/

- if current_user && current_user.admin?
  %h3= t(:demos)
  %ul
    - Script.all.each do |script|
      %li= link_to(data_t_suffix('script.name', script.name, 'desc'), script_level_path(script, ScriptLevel::NEXT))
  %h3= link_to 'Admin Stats', admin_stats_path
